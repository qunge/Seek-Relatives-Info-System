@model SRIS.ViewModels.RegisterModel
@{
    ViewBag.Title = "全部案例";
    Layout = "~/Views/Shared/_BlankPage.cshtml";
}
<body>
    <div class="main-content">
        <div class="main-content-inner">
            <div class="breadcrumbs" id="breadcrumbs">
                <script type="text/javascript">
                    try { ace.settings.check('breadcrumbs', 'fixed') } catch (e) { }
                </script>
                <ul class="breadcrumb">
                    <li>
                        <i class="ace-icon fa fa-home home-icon"></i>
                        @Html.ActionLink("首页", "Index", "Home")
                    </li>
                    <li>
                        @Html.ActionLink("全部案例", "AllCase", "Case")
                    </li>
                </ul><!-- /.breadcrumb -->
            </div>

            <div style="margin-left: 20px; margin-top:20px">
                <div class="demoTable">
                    案例编号：
                    <div class="layui-inline">
                        <input class="layui-input" id="txt_CaseCode" autocomplete="off">
                    </div>
                    寻亲类别：
                    <div class="layui-inline">
                        <div class="layui-input-inline">
                            <select id="txt_sl_SRTypeId">
                                <option value="" selected="selected">==请选择==</option>
                                <option value="1">家寻亲人</option>
                                <option value="2">家寻送养</option>
                                <option value="3">亲人寻家</option>
                                <option value="4">战友情深</option>
                                <option value="5">感恩寻人</option>
                                <option value="6">寻找老友</option>
                                <option value="7">其他寻人</option>
                                <option value="8">台海寻亲</option>
                            </select>
                        </div>
                    </div>
                    被寻人姓名：
                    <div class="layui-inline">
                        <input class="layui-input" id="txt_BeSeekerName" autocomplete="off">
                    </div>
                    领任务时间：
                    <div class="layui-inline">
                        <input type="date" class="layui-input" id="txt_getTaskDate" autocomplete="off">
                    </div>
                    <button class="layui-btn" data-type="reload">搜索</button>
                    <button id="btn_Create" class="layui-btn">新建</button>
                </div>


                <table class="layui-hide" id="test"></table>
            </div>

            <script type="text/html" id="barDemo">
                <a onclick="LinkManInfo('{{d.RegisterInfoId}}')" class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">联系人信息</a>
                <a onclick="btn_Edit('{{d.RegisterInfoId}}')" class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
                <a onclick="Del('{{d.RegisterInfoId}}')" class="layui-btn layui-btn-danger layui-btn-xs">删除</a>
            </script>

            <script type="text/html" id="djLink">
                <a href="{{d.RegisterLink}}" class="layui-table-link" target="_blank">{{ d.RegisterLink }}</a>
            </script>

            <script type="text/html" id="ftLink">
                <a href="{{d.PostLink}}" class="layui-table-link" target="_blank">{{ d.PostLink }}</a>
            </script>

            <script type="text/html" id="returnTask">
                {{#  if(d.IsReturnTask === 0){ }}
                <button id="btn_ReturnTask('{{d.RegisterInfoId}}')" class="layui-btn layui-btn-sm layui-btn-normal">退任务</button>
                {{#  } else { }}
                <button id="btn_ReturnTask('{{d.RegisterInfoId}}')" class="layui-btn layui-btn-sm layui-btn-normal">退任务信息</button>
                {{#  } }}
            </script>

            <script type="text/html" id="bbhj">
                {{#  if(d.IsBBHJ === "0"){ }}
                <button class="layui-btn layui-btn-sm layui-btn-normal">引导宝贝回家</button>
                {{#  } else { }}
                <button class="layui-btn layui-btn-sm layui-btn-normal">查看宝贝信息</button>
                {{#  } }}
            </script>

            <script>
                layui.use('table', function () {
                    var table = layui.table;

                    var tableIns = table.render({
                        elem: '#test'
                      , url: '/Case/GetAllCase'
                        //, cellMinWidth: 80 //全局定义常规单元格的最小宽度，layui 2.2.1 新增
                      , cols: [[
                        { field: 'CaseCode', title: '案例编号', width: '120' }
                        , { field: 'SRTypeName', title: '寻亲类别', width: '100' } //width 支持：数字、百分比和不填写。你还可以通过 minWidth 参数局部定义当前单元格的最小宽度，layui 2.2.1 新增
                        , { field: 'Title', title: '标题', width: '150' }
                        , { field: 'BeSeekerName', title: '被寻人姓名', width: '100' }
                        , { field: 'getTaskDate', title: '领任务时间', width: '100' }
                        , { field: 'RegisterLink', templet: '#djLink', title: '登记信息', align: 'center', width: '100' } //单元格内容水平居中
                        , { field: 'PostLink', templet: '#ftLink', title: '发帖链接', align: 'left', width: '100' } //单元格内容水平居中
                        , { field: 'IsReturnTask', templet: '#returnTask', title: '是否退任务', width: '100', align: 'left' }
                        , { field: 'IsBBHJ', title: '宝贝回家', templet: '#bbhj', width: '120', align: 'center' }
                        , { field: 'Remarks', title: '备注', align: 'left', width: '150' }
                        , { field: 'right', title: '操作', align: 'left', toolbar: '#barDemo', width: '200' }
                      ]]
                      , id: 'testReload'
                      , page: true
                      , limits: [10, 20, 30, 50, 80, 100]
                    });

                    // 搜索
                    var $ = layui.$, active = {
                        reload: function () {
                            //执行重载
                            table.reload('testReload', {
                                page: {
                                    curr: 1 //重新从第 1 页开始
                                }
                              , where: {
                                  whereStr: JSON.stringify(
                                      {
                                          caseCode: $("#txt_CaseCode").val(),
                                          srTypeId: $("#txt_sl_SRTypeId").val(),
                                          beSeekerName: $("#txt_BeSeekerName").val(),
                                          getTaskDate: $("#txt_getTaskDate").val()
                                      })
                              }
                            });
                        }
                    };

                    $('.demoTable .layui-btn').on('click', function () {
                        var type = $(this).data('type');
                        active[type] ? active[type].call(this) : '';
                    });
                });

                $(function () {
                    // 新建
                    $("#btn_Create").click(function () {
                        window.location.href = "/Case/CreateCase";
                    });
                })

                // 联系人信息
                function LinkManInfo(id) {
                    layer.open({
                        type: 2,
                        area: ['500px', '450px'],
                        fixed: false, //不固定
                        maxmin: true,
                        title: '联系人信息',
                        content: '/Case/EditLinManInfo?id=' + id
                    });
                }

                // 编辑案例信息
                function btn_Edit(id) {
                    window.location.href = "/Case/CreateCase?id=" + id;
                };

                // 删除
                function Del(id) {
                    $.post("/Case/DelRegisterInfo", { Id: id }, function (data) {
                        if (data.state) {
                            layer.alert(data.message, { icon: 1 }, function () {
                                window.location.reload();
                            });
                        }
                        else {
                            layer.alert(data.message, {icon:2});
                        }
                    }, "json")
                };

                // 退任务
                function btn_ReturnTask(id) {

                }

            </script>
        </div>
    </div>
</body>





